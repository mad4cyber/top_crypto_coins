<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸ“Š AI Dashboard - Crypto Predictor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .dashboard-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            margin-bottom: 20px;
        }
        .metric-card {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
        }
        .price-positive { color: #28a745; }
        .price-negative { color: #dc3545; }
        .refresh-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-brain"></i> Crypto AI Predictor
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/">Home</a>
                <a class="nav-link active" href="/dashboard">Dashboard</a>
                <a class="nav-link" href="/analysis">Multi-Coin Analysis</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Header -->
        <div class="row">
            <div class="col-12">
                <div class="dashboard-card p-4 text-center">
                    <h2><i class="fas fa-tachometer-alt text-primary"></i> AI Trading Dashboard</h2>
                    <p class="text-muted">Real-time AI-powered cryptocurrency analysis</p>
                    <div id="lastUpdate" class="small text-muted">Letztes Update: --</div>
                </div>
            </div>
        </div>

        <!-- Loading State -->
        <div id="loadingState" class="text-center mt-5">
            <div class="spinner-border text-light" role="status">
                <span class="visually-hidden">Lade Dashboard...</span>
            </div>
            <p class="text-light mt-3">ðŸ¤– AI analysiert Marktdaten...</p>
        </div>

        <!-- Dashboard Content -->
        <div id="dashboardContent" style="display: none;">
            <!-- Quick Stats -->
            <div class="row" id="quickStats">
                <!-- Will be populated by JavaScript -->
            </div>

            <!-- Main Chart -->
            <div class="row">
                <div class="col-lg-8">
                    <div class="dashboard-card p-4">
                        <h5><i class="fas fa-chart-line text-success"></i> Prognose-Ãœbersicht</h5>
                        <canvas id="predictionChart" height="300"></canvas>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="dashboard-card p-4">
                        <h5><i class="fas fa-trophy text-warning"></i> Top Performers</h5>
                        <div id="topPerformers">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Detailed Analysis -->
            <div class="row">
                <div class="col-12">
                    <div class="dashboard-card p-4">
                        <h5><i class="fas fa-table text-info"></i> Detaillierte Analyse</h5>
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Coin</th>
                                        <th>Aktuell</th>
                                        <th>24h Prognose</th>
                                        <th>Ã„nderung</th>
                                        <th>Konfidenz</th>
                                        <th>Signal</th>
                                    </tr>
                                </thead>
                                <tbody id="analysisTable">
                                    <!-- Will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Refresh Button -->
    <button id="refreshBtn" class="btn btn-primary btn-lg refresh-btn">
        <i class="fas fa-sync-alt"></i>
    </button>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let predictionChart = null;

        // Load dashboard on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboard();
        });

        // Refresh button
        document.getElementById('refreshBtn').addEventListener('click', function() {
            loadDashboard();
        });

        async function loadDashboard() {
            const loadingState = document.getElementById('loadingState');
            const dashboardContent = document.getElementById('dashboardContent');
            
            // Show loading
            loadingState.style.display = 'block';
            dashboardContent.style.display = 'none';

            try {
                // Fetch multi-coin analysis
                const response = await fetch('/api/multi-analysis');
                const data = await response.json();

                if (!data.success) {
                    throw new Error(data.error);
                }

                // Update dashboard with data
                updateDashboard(data);

            } catch (error) {
                alert('Fehler beim Laden des Dashboards: ' + error.message);
            } finally {
                // Hide loading
                loadingState.style.display = 'none';
                dashboardContent.style.display = 'block';
            }
        }

        function updateDashboard(data) {
            const results = data.results;
            const coins = Object.keys(results);

            // Update last update time
            const now = new Date();
            document.getElementById('lastUpdate').textContent = 
                `Letztes Update: ${now.toLocaleString('de-DE')}`;

            // Update quick stats
            updateQuickStats(results);

            // Update chart
            updatePredictionChart(results);

            // Update top performers
            updateTopPerformers(results);

            // Update analysis table
            updateAnalysisTable(results);
        }

        function updateQuickStats(results) {
            const container = document.getElementById('quickStats');
            const coins = Object.values(results);
            
            const totalCoins = coins.length;
            const avgChange = coins.reduce((sum, coin) => sum + coin.price_change_pct, 0) / totalCoins;
            const avgConfidence = coins.reduce((sum, coin) => sum + coin.confidence, 0) / totalCoins;
            const positiveCount = coins.filter(coin => coin.price_change_pct > 0).length;

            container.innerHTML = `
                <div class="col-md-3">
                    <div class="metric-card text-center">
                        <h4>${totalCoins}</h4>
                        <small>Analysierte Coins</small>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="metric-card text-center">
                        <h4 class="${avgChange >= 0 ? 'text-success' : 'text-danger'}">
                            ${avgChange > 0 ? '+' : ''}${avgChange.toFixed(2)}%
                        </h4>
                        <small>Ã˜ Ã„nderung 24h</small>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="metric-card text-center">
                        <h4>${(avgConfidence * 100).toFixed(1)}%</h4>
                        <small>Ã˜ AI-Konfidenz</small>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="metric-card text-center">
                        <h4 class="text-success">${positiveCount}/${totalCoins}</h4>
                        <small>Positive Prognosen</small>
                    </div>
                </div>
            `;
        }

        function updatePredictionChart(results) {
            const ctx = document.getElementById('predictionChart').getContext('2d');
            
            // Destroy existing chart
            if (predictionChart) {
                predictionChart.destroy();
            }

            const labels = Object.keys(results).map(coin => coin.toUpperCase());
            const changes = Object.values(results).map(coin => coin.price_change_pct);
            const confidences = Object.values(results).map(coin => coin.confidence * 100);

            predictionChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Erwartete Ã„nderung (%)',
                        data: changes,
                        backgroundColor: changes.map(change => 
                            change >= 0 ? 'rgba(40, 167, 69, 0.8)' : 'rgba(220, 53, 69, 0.8)'
                        ),
                        borderColor: changes.map(change => 
                            change >= 0 ? 'rgba(40, 167, 69, 1)' : 'rgba(220, 53, 69, 1)'
                        ),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                afterLabel: function(context) {
                                    const index = context.dataIndex;
                                    return `Konfidenz: ${confidences[index].toFixed(1)}%`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function updateTopPerformers(results) {
            const container = document.getElementById('topPerformers');
            const sorted = Object.entries(results)
                .sort((a, b) => b[1].price_change_pct - a[1].price_change_pct)
                .slice(0, 5);

            let html = '';
            sorted.forEach(([coin, data], index) => {
                const change = data.price_change_pct;
                const confidence = data.confidence;
                const rank = index + 1;
                
                html += `
                    <div class="d-flex justify-content-between align-items-center mb-2 p-2 border rounded">
                        <div>
                            <strong>${rank}. ${coin.toUpperCase()}</strong>
                            <br>
                            <small class="text-muted">Konfidenz: ${(confidence * 100).toFixed(1)}%</small>
                        </div>
                        <div class="text-end">
                            <div class="${change >= 0 ? 'price-positive' : 'price-negative'}">
                                ${change > 0 ? '+' : ''}${change.toFixed(2)}%
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function updateAnalysisTable(results) {
            const tbody = document.getElementById('analysisTable');
            const sorted = Object.entries(results)
                .sort((a, b) => b[1].price_change_pct - a[1].price_change_pct);

            let html = '';
            sorted.forEach(([coin, data]) => {
                const change = data.price_change_pct;
                const confidence = data.confidence;
                
                let signal = '';
                let signalClass = '';
                if (change > 5) {
                    signal = 'ðŸš€ STRONG BUY';
                    signalClass = 'text-success fw-bold';
                } else if (change > 2) {
                    signal = 'ðŸŸ¢ BUY';
                    signalClass = 'text-success';
                } else if (change > -2) {
                    signal = 'âšª HOLD';
                    signalClass = 'text-muted';
                } else if (change > -5) {
                    signal = 'ðŸŸ  SELL';
                    signalClass = 'text-warning';
                } else {
                    signal = 'ðŸ”´ STRONG SELL';
                    signalClass = 'text-danger fw-bold';
                }

                html += `
                    <tr>
                        <td><strong>${coin.toUpperCase()}</strong></td>
                        <td>â‚¬${data.current_price.toFixed(2)}</td>
                        <td>â‚¬${data.predicted_price.toFixed(2)}</td>
                        <td class="${change >= 0 ? 'price-positive' : 'price-negative'}">
                            ${change > 0 ? '+' : ''}${change.toFixed(2)}%
                        </td>
                        <td>
                            <div class="progress" style="height: 20px;">
                                <div class="progress-bar bg-info" style="width: ${confidence * 100}%">
                                    ${(confidence * 100).toFixed(1)}%
                                </div>
                            </div>
                        </td>
                        <td class="${signalClass}">${signal}</td>
                    </tr>
                `;
            });

            tbody.innerHTML = html;
        }
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸ“ˆ Professional Charts - Crypto AI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: white;
        }
        .chart-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(20px);
            margin-bottom: 20px;
            color: #333;
        }
        .indicator-panel {
            background: rgba(0, 0, 0, 0.8);
            border-radius: 10px;
            padding: 15px;
            color: white;
            margin-bottom: 15px;
        }
        .technical-indicator {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
        }
        .indicator-value.bullish { color: #28a745; }
        .indicator-value.bearish { color: #dc3545; }
        .indicator-value.neutral { color: #ffc107; }
        .chart-controls {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .price-display {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            font-size: 1.2em;
        }
        .signal-strong { 
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            border: none;
        }
        .signal-weak { 
            background: linear-gradient(45deg, #6c757d, #adb5bd);
            color: white;
            border: none;
        }
        .signal-negative { 
            background: linear-gradient(45deg, #dc3545, #fd7e14);
            color: white;
            border: none;
        }
        .volume-bar {
            height: 4px;
            background: #e9ecef;
            border-radius: 2px;
            overflow: hidden;
            margin-top: 5px;
        }
        .volume-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            transition: width 0.5s ease;
        }
        .pattern-alert {
            border-left: 4px solid;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.1);
        }
        .pattern-bullish { border-left-color: #28a745; }
        .pattern-bearish { border-left-color: #dc3545; }
        .pattern-neutral { border-left-color: #ffc107; }
        .live-price {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-brain"></i> Crypto AI Predictor
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/">Home</a>
                <a class="nav-link" href="/dashboard">Dashboard</a>
                <a class="nav-link" href="/analysis">Analysis</a>
                <a class="nav-link" href="/portfolio">Portfolio</a>
                <a class="nav-link" href="/performance">Performance</a>
                <a class="nav-link" href="/ml-optimization">ðŸ§  ML Optimization</a>
                <a class="nav-link" href="/realtime-sentiment">ðŸ“Š Live Sentiment</a>
                <a class="nav-link" href="/trading-interface">ðŸ’¼ Trading</a>
                <a class="nav-link active" href="/professional-charts">ðŸ“ˆ Charts</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Header -->
        <div class="row">
            <div class="col-12">
                <div class="chart-card p-4 text-center">
                    <h2>ðŸ“ˆ Professional Trading Charts</h2>
                    <p class="text-muted">
                        Advanced technical analysis with AI-powered insights and pattern recognition
                    </p>
                </div>
            </div>
        </div>

        <!-- Chart Controls -->
        <div class="row">
            <div class="col-12">
                <div class="chart-controls">
                    <div class="row align-items-center">
                        <div class="col-md-3">
                            <label class="form-label text-white">Cryptocurrency</label>
                            <select id="coinSelect" class="form-select">
                                <option value="BINANCE:BTCUSDT" selected>Bitcoin (BTC/USDT)</option>
                                <option value="BINANCE:ETHUSDT">Ethereum (ETH/USDT)</option>
                                <option value="BINANCE:BNBUSDT">Binance Coin (BNB/USDT)</option>
                                <option value="BINANCE:SOLUSDT">Solana (SOL/USDT)</option>
                                <option value="BINANCE:ADAUSDT">Cardano (ADA/USDT)</option>
                                <option value="BINANCE:XRPUSDT">Ripple (XRP/USDT)</option>
                                <option value="BINANCE:DOGEUSDT">Dogecoin (DOGE/USDT)</option>
                                <option value="BINANCE:AVAXUSDT">Avalanche (AVAX/USDT)</option>
                                <option value="BINANCE:LINKUSDT">Chainlink (LINK/USDT)</option>
                                <option value="BINANCE:MATICUSDT">Polygon (MATIC/USDT)</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label text-white">Timeframe</label>
                            <select id="timeframeSelect" class="form-select">
                                <option value="1">1 Minute</option>
                                <option value="5">5 Minutes</option>
                                <option value="15">15 Minutes</option>
                                <option value="30">30 Minutes</option>
                                <option value="60" selected>1 Hour</option>
                                <option value="240">4 Hours</option>
                                <option value="1D">1 Day</option>
                                <option value="1W">1 Week</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label text-white">Chart Style</label>
                            <select id="chartStyleSelect" class="form-select">
                                <option value="1" selected>Candlesticks</option>
                                <option value="2">OHLC Bars</option>
                                <option value="3">Line</option>
                                <option value="4">Area</option>
                                <option value="8">Heikin Ashi</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label text-white">Actions</label>
                            <div class="btn-group w-100">
                                <button class="btn btn-primary" onclick="updateChart()">
                                    <i class="fas fa-sync-alt"></i> Update
                                </button>
                                <button class="btn btn-success" onclick="toggleFullscreen()">
                                    <i class="fas fa-expand"></i> Full
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Chart and Indicators -->
        <div class="row">
            <!-- Chart -->
            <div class="col-lg-8">
                <div class="chart-card p-3">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 id="chartTitle">Bitcoin (BTC/USDT) - 1H</h5>
                        <div class="live-price">
                            <span id="currentPrice" class="price-display text-success">$0.00</span>
                            <small id="priceChange" class="text-muted">--</small>
                        </div>
                    </div>
                    
                    <!-- TradingView Chart -->
                    <div id="tradingview_chart" style="height: 500px; border-radius: 10px; overflow: hidden;"></div>
                    
                    <!-- Chart Footer -->
                    <div class="row mt-3">
                        <div class="col-md-3 text-center">
                            <small class="text-muted">24h Volume</small>
                            <div id="volume24h" class="fw-bold">--</div>
                        </div>
                        <div class="col-md-3 text-center">
                            <small class="text-muted">Market Cap</small>
                            <div id="marketCap" class="fw-bold">--</div>
                        </div>
                        <div class="col-md-3 text-center">
                            <small class="text-muted">24h Range</small>
                            <div id="dayRange" class="fw-bold">--</div>
                        </div>
                        <div class="col-md-3 text-center">
                            <small class="text-muted">All Time High</small>
                            <div id="allTimeHigh" class="fw-bold">--</div>
                        </div>
                    </div>
                </div>
                
                <!-- Pattern Recognition -->
                <div class="indicator-panel">
                    <h6><i class="fas fa-search text-warning"></i> AI Pattern Recognition</h6>
                    <div id="patternAlerts">
                        <!-- Pattern alerts will be populated here -->
                        <div class="text-center text-muted">
                            <i class="fas fa-chart-line fa-2x mb-2"></i>
                            <p>Analyzing patterns...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Technical Indicators -->
            <div class="col-lg-4">
                <!-- Current Price Info -->
                <div class="indicator-panel">
                    <h6><i class="fas fa-dollar-sign text-success"></i> Price Information</h6>
                    <div class="row">
                        <div class="col-6">
                            <small class="text-muted">Open</small>
                            <div id="openPrice" class="price-display">--</div>
                        </div>
                        <div class="col-6">
                            <small class="text-muted">High</small>
                            <div id="highPrice" class="price-display">--</div>
                        </div>
                        <div class="col-6 mt-2">
                            <small class="text-muted">Low</small>
                            <div id="lowPrice" class="price-display">--</div>
                        </div>
                        <div class="col-6 mt-2">
                            <small class="text-muted">Close</small>
                            <div id="closePrice" class="price-display">--</div>
                        </div>
                    </div>
                </div>

                <!-- RSI Indicator -->
                <div class="technical-indicator">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <strong>RSI (14)</strong>
                            <div class="small text-muted">Relative Strength Index</div>
                        </div>
                        <div class="text-end">
                            <div id="rsiValue" class="indicator-value neutral">50.0</div>
                            <div id="rsiSignal" class="small">Neutral</div>
                        </div>
                    </div>
                    <div class="progress mt-2" style="height: 8px;">
                        <div id="rsiProgress" class="progress-bar bg-warning" style="width: 50%"></div>
                    </div>
                </div>

                <!-- MACD Indicator -->
                <div class="technical-indicator">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <strong>MACD (12,26,9)</strong>
                            <div class="small text-muted">Moving Average Convergence</div>
                        </div>
                        <div class="text-end">
                            <div id="macdValue" class="indicator-value neutral">0.00</div>
                            <div id="macdSignal" class="small">Neutral</div>
                        </div>
                    </div>
                </div>

                <!-- Bollinger Bands -->
                <div class="technical-indicator">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <strong>Bollinger Bands</strong>
                            <div class="small text-muted">20-period, 2 std dev</div>
                        </div>
                        <div class="text-end">
                            <div class="small">
                                Upper: <span id="bbUpper">--</span><br>
                                Lower: <span id="bbLower">--</span>
                            </div>
                            <div id="bbSignal" class="indicator-value neutral">Normal</div>
                        </div>
                    </div>
                </div>

                <!-- Stochastic -->
                <div class="technical-indicator">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <strong>Stochastic (14,3,3)</strong>
                            <div class="small text-muted">Momentum Oscillator</div>
                        </div>
                        <div class="text-end">
                            <div id="stochValue" class="indicator-value neutral">50.0</div>
                            <div id="stochSignal" class="small">Neutral</div>
                        </div>
                    </div>
                </div>

                <!-- Volume Analysis -->
                <div class="technical-indicator">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <strong>Volume Analysis</strong>
                            <div class="small text-muted">Current vs Average</div>
                        </div>
                        <div class="text-end">
                            <div id="volumeRatio" class="indicator-value neutral">1.0x</div>
                            <div id="volumeSignal" class="small">Normal</div>
                        </div>
                    </div>
                    <div class="volume-bar">
                        <div id="volumeFill" class="volume-fill" style="width: 50%"></div>
                    </div>
                </div>

                <!-- Moving Averages -->
                <div class="indicator-panel">
                    <h6><i class="fas fa-chart-line text-info"></i> Moving Averages</h6>
                    <div class="row">
                        <div class="col-6">
                            <div class="technical-indicator">
                                <div class="text-center">
                                    <div class="small text-muted">MA 20</div>
                                    <div id="ma20" class="price-display">--</div>
                                    <div id="ma20Signal" class="small">--</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="technical-indicator">
                                <div class="text-center">
                                    <div class="small text-muted">MA 50</div>
                                    <div id="ma50" class="price-display">--</div>
                                    <div id="ma50Signal" class="small">--</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="technical-indicator">
                                <div class="text-center">
                                    <div class="small text-muted">EMA 12</div>
                                    <div id="ema12" class="price-display">--</div>
                                    <div id="ema12Signal" class="small">--</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="technical-indicator">
                                <div class="text-center">
                                    <div class="small text-muted">EMA 26</div>
                                    <div id="ema26" class="price-display">--</div>
                                    <div id="ema26Signal" class="small">--</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Overall Technical Summary -->
                <div class="indicator-panel">
                    <h6><i class="fas fa-chart-bar text-primary"></i> Technical Summary</h6>
                    <div class="text-center">
                        <div id="overallSignal" class="btn signal-weak mb-2">NEUTRAL</div>
                        <div id="signalStrength" class="small">Based on 8 indicators</div>
                        <div class="row mt-3">
                            <div class="col-4 text-center">
                                <div id="bullishCount" class="h5 text-success">0</div>
                                <small>Bullish</small>
                            </div>
                            <div class="col-4 text-center">
                                <div id="neutralCount" class="h5 text-warning">0</div>
                                <small>Neutral</small>
                            </div>
                            <div class="col-4 text-center">
                                <div id="bearishCount" class="h5 text-danger">0</div>
                                <small>Bearish</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AI Trading Suggestions -->
                <div class="indicator-panel">
                    <h6><i class="fas fa-robot text-success"></i> AI Trading Suggestions</h6>
                    <div id="tradingSuggestions">
                        <!-- AI suggestions will be populated here -->
                        <div class="text-center text-muted">
                            <i class="fas fa-brain fa-2x mb-2"></i>
                            <p>Analyzing market conditions...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <script>
        let tradingViewWidget = null;
        let currentSymbol = 'BINANCE:BTCUSDT';
        let currentTimeframe = '60';
        let updateInterval = null;

        document.addEventListener('DOMContentLoaded', function() {
            initializeTradingView();
            loadTechnicalIndicators();
            startAutoUpdate();

            // Event listeners
            document.getElementById('coinSelect').addEventListener('change', updateChart);
            document.getElementById('timeframeSelect').addEventListener('change', updateChart);
            document.getElementById('chartStyleSelect').addEventListener('change', updateChart);
        });

        function initializeTradingView() {
            try {
                tradingViewWidget = new TradingView.widget({
                    autosize: true,
                    symbol: currentSymbol,
                    interval: currentTimeframe,
                    container_id: "tradingview_chart",
                    theme: "dark",
                    style: "1",
                    locale: "en",
                    toolbar_bg: "#1e3c72",
                    enable_publishing: false,
                    hide_top_toolbar: false,
                    hide_legend: false,
                    save_image: false,
                    studies: [
                        "RSI@tv-basicstudies",
                        "MACD@tv-basicstudies",
                        "BB@tv-basicstudies",
                        "Stochastic@tv-basicstudies",
                        "Volume@tv-basicstudies"
                    ],
                    overrides: {
                        "paneProperties.background": "#1e3c72",
                        "paneProperties.backgroundGradientStartColor": "#1e3c72",
                        "paneProperties.backgroundGradientEndColor": "#2a5298",
                        "scalesProperties.textColor": "#ffffff",
                        "paneProperties.vertGridProperties.color": "rgba(255,255,255,0.1)",
                        "paneProperties.horzGridProperties.color": "rgba(255,255,255,0.1)"
                    },
                    studies_overrides: {
                        "volume.volume.color.0": "#dc3545",
                        "volume.volume.color.1": "#28a745",
                        "RSI.RSI.color": "#ffc107",
                        "MACD.MACD.color": "#20c997",
                        "MACD.signal.color": "#fd7e14",
                        "BB.upper.color": "#6f42c1",
                        "BB.lower.color": "#6f42c1",
                        "BB.median.color": "#6f42c1"
                    }
                });

                console.log('TradingView chart initialized');
            } catch (error) {
                console.error('Error initializing TradingView:', error);
                document.getElementById('tradingview_chart').innerHTML = 
                    '<div class="d-flex justify-content-center align-items-center h-100">' +
                    '<div class="text-center"><i class="fas fa-exclamation-triangle fa-3x text-warning mb-3"></i>' +
                    '<p>Chart could not be loaded</p></div></div>';
            }
        }

        function updateChart() {
            currentSymbol = document.getElementById('coinSelect').value;
            currentTimeframe = document.getElementById('timeframeSelect').value;
            const chartStyle = document.getElementById('chartStyleSelect').value;

            // Update chart title
            const coinName = document.getElementById('coinSelect').selectedOptions[0].text;
            const timeframeName = document.getElementById('timeframeSelect').selectedOptions[0].text;
            document.getElementById('chartTitle').textContent = `${coinName} - ${timeframeName}`;

            // Reinitialize TradingView widget
            if (tradingViewWidget) {
                document.getElementById('tradingview_chart').innerHTML = '';
            }

            try {
                tradingViewWidget = new TradingView.widget({
                    autosize: true,
                    symbol: currentSymbol,
                    interval: currentTimeframe,
                    container_id: "tradingview_chart",
                    theme: "dark",
                    style: chartStyle,
                    locale: "en",
                    toolbar_bg: "#1e3c72",
                    enable_publishing: false,
                    hide_top_toolbar: false,
                    hide_legend: false,
                    save_image: false,
                    studies: [
                        "RSI@tv-basicstudies",
                        "MACD@tv-basicstudies", 
                        "BB@tv-basicstudies",
                        "Stochastic@tv-basicstudies",
                        "Volume@tv-basicstudies"
                    ],
                    overrides: {
                        "paneProperties.background": "#1e3c72",
                        "paneProperties.backgroundGradientStartColor": "#1e3c72",
                        "paneProperties.backgroundGradientEndColor": "#2a5298",
                        "scalesProperties.textColor": "#ffffff",
                        "paneProperties.vertGridProperties.color": "rgba(255,255,255,0.1)",
                        "paneProperties.horzGridProperties.color": "rgba(255,255,255,0.1)"
                    }
                });

                // Update technical indicators
                loadTechnicalIndicators();

            } catch (error) {
                console.error('Error updating chart:', error);
            }
        }

        async function loadTechnicalIndicators() {
            try {
                // Extract coin symbol from TradingView symbol
                const coinSymbol = currentSymbol.split(':')[1].replace('USDT', '').toLowerCase();
                
                // Simulate technical indicator data (in production, would fetch real data)
                const indicators = generateSimulatedIndicators();
                
                // Update RSI
                updateRSI(indicators.rsi);
                
                // Update MACD
                updateMACD(indicators.macd);
                
                // Update Bollinger Bands
                updateBollingerBands(indicators.bb);
                
                // Update Stochastic
                updateStochastic(indicators.stoch);
                
                // Update Volume
                updateVolumeAnalysis(indicators.volume);
                
                // Update Moving Averages
                updateMovingAverages(indicators.ma);
                
                // Update price information
                updatePriceInfo(indicators.price);
                
                // Update overall technical summary
                updateTechnicalSummary(indicators);
                
                // Update pattern recognition
                updatePatternRecognition();
                
                // Update AI trading suggestions
                updateTradingSuggestions(indicators);
                
            } catch (error) {
                console.error('Error loading technical indicators:', error);
            }
        }

        function generateSimulatedIndicators() {
            // Simulate realistic technical indicator values
            const basePrice = Math.random() * 50000 + 20000; // $20k-$70k range
            const volatility = Math.random() * 0.05 + 0.02; // 2-7% volatility
            
            return {
                price: {
                    current: basePrice,
                    open: basePrice * (1 + (Math.random() - 0.5) * volatility),
                    high: basePrice * (1 + Math.random() * volatility * 0.5),
                    low: basePrice * (1 - Math.random() * volatility * 0.5),
                    close: basePrice,
                    change24h: (Math.random() - 0.5) * 0.1, // Â±10%
                    volume24h: Math.random() * 50000000000 + 10000000000 // $10B-$60B
                },
                rsi: Math.random() * 100,
                macd: {
                    macd: (Math.random() - 0.5) * 1000,
                    signal: (Math.random() - 0.5) * 1000,
                    histogram: (Math.random() - 0.5) * 500
                },
                bb: {
                    upper: basePrice * 1.02,
                    lower: basePrice * 0.98,
                    middle: basePrice
                },
                stoch: {
                    k: Math.random() * 100,
                    d: Math.random() * 100
                },
                volume: {
                    current: Math.random() * 2000000000 + 500000000,
                    average: Math.random() * 1500000000 + 750000000,
                    ratio: Math.random() * 3 + 0.5 // 0.5x - 3.5x
                },
                ma: {
                    ma20: basePrice * (1 + (Math.random() - 0.5) * 0.03),
                    ma50: basePrice * (1 + (Math.random() - 0.5) * 0.05),
                    ema12: basePrice * (1 + (Math.random() - 0.5) * 0.02),
                    ema26: basePrice * (1 + (Math.random() - 0.5) * 0.04)
                }
            };
        }

        function updateRSI(rsi) {
            const rsiElement = document.getElementById('rsiValue');
            const signalElement = document.getElementById('rsiSignal');
            const progressElement = document.getElementById('rsiProgress');
            
            rsiElement.textContent = rsi.toFixed(1);
            progressElement.style.width = `${rsi}%`;
            
            if (rsi >= 70) {
                rsiElement.className = 'indicator-value bearish';
                signalElement.textContent = 'Overbought';
                progressElement.className = 'progress-bar bg-danger';
            } else if (rsi <= 30) {
                rsiElement.className = 'indicator-value bullish';
                signalElement.textContent = 'Oversold';
                progressElement.className = 'progress-bar bg-success';
            } else {
                rsiElement.className = 'indicator-value neutral';
                signalElement.textContent = 'Neutral';
                progressElement.className = 'progress-bar bg-warning';
            }
        }

        function updateMACD(macd) {
            const valueElement = document.getElementById('macdValue');
            const signalElement = document.getElementById('macdSignal');
            
            valueElement.textContent = macd.macd.toFixed(2);
            
            if (macd.macd > macd.signal) {
                valueElement.className = 'indicator-value bullish';
                signalElement.textContent = 'Bullish';
            } else {
                valueElement.className = 'indicator-value bearish';
                signalElement.textContent = 'Bearish';
            }
        }

        function updateBollingerBands(bb) {
            document.getElementById('bbUpper').textContent = `$${bb.upper.toFixed(0)}`;
            document.getElementById('bbLower').textContent = `$${bb.lower.toFixed(0)}`;
            
            const currentPrice = bb.middle; // Assuming current price
            const signalElement = document.getElementById('bbSignal');
            
            if (currentPrice >= bb.upper) {
                signalElement.className = 'indicator-value bearish';
                signalElement.textContent = 'Overbought';
            } else if (currentPrice <= bb.lower) {
                signalElement.className = 'indicator-value bullish';
                signalElement.textContent = 'Oversold';
            } else {
                signalElement.className = 'indicator-value neutral';
                signalElement.textContent = 'Normal';
            }
        }

        function updateStochastic(stoch) {
            const valueElement = document.getElementById('stochValue');
            const signalElement = document.getElementById('stochSignal');
            
            valueElement.textContent = stoch.k.toFixed(1);
            
            if (stoch.k >= 80) {
                valueElement.className = 'indicator-value bearish';
                signalElement.textContent = 'Overbought';
            } else if (stoch.k <= 20) {
                valueElement.className = 'indicator-value bullish';
                signalElement.textContent = 'Oversold';
            } else {
                valueElement.className = 'indicator-value neutral';
                signalElement.textContent = 'Neutral';
            }
        }

        function updateVolumeAnalysis(volume) {
            const ratioElement = document.getElementById('volumeRatio');
            const signalElement = document.getElementById('volumeSignal');
            const fillElement = document.getElementById('volumeFill');
            
            ratioElement.textContent = `${volume.ratio.toFixed(1)}x`;
            fillElement.style.width = `${Math.min(volume.ratio * 33, 100)}%`;
            
            if (volume.ratio >= 1.5) {
                ratioElement.className = 'indicator-value bullish';
                signalElement.textContent = 'High Volume';
            } else if (volume.ratio <= 0.5) {
                ratioElement.className = 'indicator-value bearish';
                signalElement.textContent = 'Low Volume';
            } else {
                ratioElement.className = 'indicator-value neutral';
                signalElement.textContent = 'Normal';
            }
        }

        function updateMovingAverages(ma) {
            const currentPrice = ma.ma20; // Approximate current price
            
            // Update MA values
            document.getElementById('ma20').textContent = `$${ma.ma20.toFixed(0)}`;
            document.getElementById('ma50').textContent = `$${ma.ma50.toFixed(0)}`;
            document.getElementById('ema12').textContent = `$${ma.ema12.toFixed(0)}`;
            document.getElementById('ema26').textContent = `$${ma.ema26.toFixed(0)}`;
            
            // Update signals based on price vs MA
            document.getElementById('ma20Signal').textContent = currentPrice > ma.ma20 ? 'Above' : 'Below';
            document.getElementById('ma50Signal').textContent = currentPrice > ma.ma50 ? 'Above' : 'Below';
            document.getElementById('ema12Signal').textContent = currentPrice > ma.ema12 ? 'Above' : 'Below';
            document.getElementById('ema26Signal').textContent = currentPrice > ma.ema26 ? 'Above' : 'Below';
        }

        function updatePriceInfo(price) {
            document.getElementById('currentPrice').textContent = `$${price.current.toFixed(2)}`;
            document.getElementById('openPrice').textContent = `$${price.open.toFixed(2)}`;
            document.getElementById('highPrice').textContent = `$${price.high.toFixed(2)}`;
            document.getElementById('lowPrice').textContent = `$${price.low.toFixed(2)}`;
            document.getElementById('closePrice').textContent = `$${price.close.toFixed(2)}`;
            
            const changeElement = document.getElementById('priceChange');
            const changePct = price.change24h * 100;
            changeElement.textContent = `${changePct >= 0 ? '+' : ''}${changePct.toFixed(2)}%`;
            changeElement.className = changePct >= 0 ? 'text-success' : 'text-danger';
            
            // Update volume and market info
            document.getElementById('volume24h').textContent = `$${(price.volume24h / 1000000000).toFixed(1)}B`;
        }

        function updateTechnicalSummary(indicators) {
            let bullishCount = 0;
            let bearishCount = 0;
            let neutralCount = 0;
            
            // Analyze each indicator
            if (indicators.rsi <= 30) bullishCount++;
            else if (indicators.rsi >= 70) bearishCount++;
            else neutralCount++;
            
            if (indicators.macd.macd > indicators.macd.signal) bullishCount++;
            else bearishCount++;
            
            if (indicators.stoch.k <= 20) bullishCount++;
            else if (indicators.stoch.k >= 80) bearishCount++;
            else neutralCount++;
            
            if (indicators.volume.ratio >= 1.5) bullishCount++;
            else if (indicators.volume.ratio <= 0.5) bearishCount++;
            else neutralCount++;
            
            // Update counts
            document.getElementById('bullishCount').textContent = bullishCount;
            document.getElementById('bearishCount').textContent = bearishCount;
            document.getElementById('neutralCount').textContent = neutralCount;
            
            // Update overall signal
            const signalElement = document.getElementById('overallSignal');
            if (bullishCount > bearishCount) {
                signalElement.textContent = 'BULLISH';
                signalElement.className = 'btn signal-strong';
            } else if (bearishCount > bullishCount) {
                signalElement.textContent = 'BEARISH';
                signalElement.className = 'btn signal-negative';
            } else {
                signalElement.textContent = 'NEUTRAL';
                signalElement.className = 'btn signal-weak';
            }
        }

        function updatePatternRecognition() {
            const patterns = [
                { name: 'Double Bottom', type: 'bullish', confidence: 'High', description: 'Strong reversal pattern detected' },
                { name: 'Rising Wedge', type: 'bearish', confidence: 'Medium', description: 'Potential bearish breakout expected' },
                { name: 'Bull Flag', type: 'bullish', confidence: 'Medium', description: 'Continuation pattern forming' }
            ];
            
            const container = document.getElementById('patternAlerts');
            container.innerHTML = patterns.map(pattern => `
                <div class="pattern-alert pattern-${pattern.type}">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <strong>${pattern.name}</strong>
                            <div class="small">${pattern.description}</div>
                        </div>
                        <div class="text-end">
                            <div class="small">Confidence: ${pattern.confidence}</div>
                            <span class="badge bg-${pattern.type === 'bullish' ? 'success' : 'danger'}">
                                ${pattern.type.toUpperCase()}
                            </span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function updateTradingSuggestions(indicators) {
            const suggestions = [
                'ðŸ“ˆ Strong bullish momentum on RSI divergence',
                'âš ï¸ Watch for volume confirmation on breakout',
                'ðŸŽ¯ Consider taking profits near resistance at $52,000',
                'ðŸ›¡ï¸ Set stop-loss below support at $48,000'
            ];
            
            const container = document.getElementById('tradingSuggestions');
            container.innerHTML = suggestions.map(suggestion => `
                <div class="alert alert-info py-2 mb-2">
                    <small>${suggestion}</small>
                </div>
            `).join('');
        }

        function startAutoUpdate() {
            updateInterval = setInterval(() => {
                loadTechnicalIndicators();
            }, 30000); // Update every 30 seconds
        }

        function toggleFullscreen() {
            const chartElement = document.getElementById('tradingview_chart');
            if (chartElement.requestFullscreen) {
                chartElement.requestFullscreen();
            } else if (chartElement.webkitRequestFullscreen) {
                chartElement.webkitRequestFullscreen();
            } else if (chartElement.msRequestFullscreen) {
                chartElement.msRequestFullscreen();
            }
        }

        // Cleanup on page unload
        window.addEventListener('beforeunload', function() {
            if (updateInterval) {
                clearInterval(updateInterval);
            }
        });
    </script>
</body>
</html>